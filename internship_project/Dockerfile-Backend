# Build stage
FROM gradle:7.2-jdk11 AS build

WORKDIR /app

# Copy the entire project
COPY . .

# Build the application, skipping tests
RUN gradle build -x test --no-daemon

# Runtime stage
FROM tomcat:9.0.50-jdk11-openjdk

# Remove default Tomcat applications
RUN rm -rf /usr/local/tomcat/webapps/*

# Copy the built WAR file from the build stage
COPY --from=build /app/build/libs/class_schedule.war /usr/local/tomcat/webapps/ROOT.war

# Expose the default Tomcat port
EXPOSE 8080

CMD ["catalina.sh", "run"]